{% extends "base.html" %}

{% block title %}{{ cliente.nome }} — Carteira Ativa{% endblock %}

{% block content %}

{# ── Cabeçalho ────────────────────────────────────────────────────────── #}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="mb-0">{{ cliente.nome }}</h2>
        <small class="text-muted">
            <span class="badge bg-success">Ativo</span>
            &nbsp;{{ cliente.get_tipo_display }}
        </small>
    </div>
    <a href="{% url 'carteira_ativa:carteira_list' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Voltar
    </a>
</div>

{# ── Dados do cliente ─────────────────────────────────────────────────── #}
<div class="row g-3">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header fw-semibold">
                <i class="bi bi-building me-1"></i> Dados Cadastrais
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-4">CNPJ/CPF</dt>
                    <dd class="col-sm-8">{{ cliente.cnpj_cpf|default:"—" }}</dd>

                    <dt class="col-sm-4">Tipo</dt>
                    <dd class="col-sm-8">{{ cliente.get_tipo_display }}</dd>

                    <dt class="col-sm-4">Telefone</dt>
                    <dd class="col-sm-8">{{ cliente.telefone|default:"—" }}</dd>

                    <dt class="col-sm-4">E-mail</dt>
                    <dd class="col-sm-8">{{ cliente.email|default:"—" }}</dd>

                    <dt class="col-sm-4">Criado por</dt>
                    <dd class="col-sm-8">{{ cliente.criado_por.get_full_name|default:cliente.criado_por.username }}</dd>

                    <dt class="col-sm-4">Criado em</dt>
                    <dd class="col-sm-8">{{ cliente.criado_em|date:"d/m/Y" }}</dd>

                    <dt class="col-sm-4">Atualizado em</dt>
                    <dd class="col-sm-8">{{ cliente.atualizado_em|date:"d/m/Y" }}</dd>
                </dl>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header fw-semibold">
                <i class="bi bi-person me-1"></i> Contato Principal
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-4">Nome</dt>
                    <dd class="col-sm-8">{{ cliente.nome_contato_principal|default:"—" }}</dd>

                    <dt class="col-sm-4">Telefone</dt>
                    <dd class="col-sm-8">{{ cliente.telefone_contato|default:"—" }}</dd>

                    <dt class="col-sm-4">E-mail</dt>
                    <dd class="col-sm-8">{{ cliente.email_contato|default:"—" }}</dd>
                </dl>
            </div>
        </div>
    </div>
</div>

{# ── Oportunidades vinculadas ─────────────────────────────────────────── #}
<div class="mt-4">
    <h5><i class="bi bi-funnel me-1"></i> Oportunidades</h5>
    <ul class="list-group">
        {% for op in cliente.oportunidades.all %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <a href="{% url 'sales:oportunidade_detail' op.pk %}" class="text-decoration-none">
                {{ op.titulo }}
            </a>
            <span class="badge bg-primary">{{ op.get_etapa_display }}</span>
        </li>
        {% empty %}
        <li class="list-group-item text-muted">
            <i class="bi bi-dash-circle me-1"></i> Nenhuma oportunidade registrada.
        </li>
        {% endfor %}
    </ul>
</div>

{% endblock %}
